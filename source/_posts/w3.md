---
title: w3-RK_NPU_SDK 环境配置
date: 2023-10-09 21:33:22
categories: Intelligent information system design
tag: 嵌入式
---
> 本博客参考了 [Rockchip_Quick_Start_RKNN_SDK_V1.5.2_CN.pdf](https://eyun.baidu.com/enterprise/share/link?cid=8272257679089781337&uk=1883176049&sid=202205053973938618#sharelink/path=%2FRK_NPU_SDK%2FRK_NPU_SDK_1.5.2%2Frelease&parent_path=%2FGPU%2Frknn-toolkit2)
>
## `RKNN Toolkit2` 的配置（非 `Docker`）

> `1.5.2` 以前的版本依赖 `bfloat16` 来运行，而 `bfloat16` 目前可直接下载的版本 `1.2` 只支持 `Python3.9` 以上的环境（老版本似乎缺少了必要的构建文件），而 `RKNN Toolkit2` 只有 `3.6` 和 `3.8` 的 `wheel` 支持，因此推荐使用 `1.5.2` 的版本

`RKNN Toolkit2` 是一个在 Linux（非板上系统）上运行的一个进行模型转化和部署的工具，提供了 Python 的接口，通过 `adb` 工具进行板上推理

首先下载 [RKNN-Toolkit2](https://github.com/rockchip-linux/rknn-toolkit2/tree/master)：

```sh
git clone --depth=1 https://github.com/rockchip-linux/rknn-toolkit2.git
```

这里使用 `git` 进行下载，当然直接下载压缩包也是一样的

然后使用 `conda` 或者 `venv` 创建虚拟环境，这里使用 `conda`：

```sh
conda create -n rknn python=3.10
```

其中，环境名 `rknn` 可以随意替换，支持的 `Python` 版本请查看所下载的 `rknn-toolkit2` 文件夹下的 `packages` 文件夹，如下所示：

```sh
rknn_toolkit2-1.5.2+b642f30c-cp36-cp36m-linux_x86_64.whl
rknn_toolkit2-1.5.2+b642f30c-cp310-cp310-linux_x86_64.whl
rknn_toolkit2-1.5.2+b642f30c-cp38-cp38-linux_x86_64.whl
```

如上所示，`1.5.2` 版本的 `RKNN Toolkit2` 支持 `Python` 的 `3.6` `3.8` `3.10` 版本

然后在所下载的 `rknn-toolkit2` 文件夹下打开终端，分别输入：

```sh
sudo apt-get install libxslt1-dev zlib1g-dev libglib2.0 libsm6 \
libgl1-mesa-glx libprotobuf-dev gcc
conda activate rknn
pip3 install -r requirements_cp310-1.5.2.txt
pip3 install \
packages/rknn_toolkit2-1.5.2+b642f30c-cp310-cp310-linux_x86_64.whl
```

注意把文件名替换为自己下载的 `RKNN Toolkit2` 文件

使用以下命令测试安装：

```sh
python
from rknn.api import RKNN
```

## `RKNN Toolkit Lite2` 的配置

`RKNN Toolkit Lite2` 和 `RKNN Toolkit2` 类似，可以用于在板端以完全离线的方式部署 RKNN 模型，但是提供的接口较少

首先在板上下载 `Miniconda`：

```sh
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-aarch64.sh
```

然后安装 `Miniconda`：

```sh
bash Miniconda3-latest-Linux-aarch64.sh
```

根据指示安装即可，其中会出现一大堆的协议，可用 `<C-D>` 来向下翻页，注意这也是一个退出当前 `shell` 的快捷键，不要连着按

剩下的过程与 [安装 RKNN Toolkit2](#rknn-toolkit2-的配置非-docker) 类似，首先创建 `conda` 环境，然后安装依赖：

```sh
pip install numpy opencv-python
```

安装 `RKNN Toolkit Lite2`：

```sh
pip3 install packages/rknn_toolkit_lite2-1.5.2-cp310-cp310-linux_aarch64.whl
```

## `RKNPU2` 的安装配置
